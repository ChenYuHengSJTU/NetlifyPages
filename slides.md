## Vim 解决问题的方式

+ 结识.命令
  + 规划按键操作
  + 一次按键移动，一次按键执行
+ 不要自我重复
  + 复合命令
    +   | 复合命令|等效命令|
        |---|----|
        | C | c$ |
        | s | cl |
        |S|^c|
        |I|^i|
        |A|$a|
        |o|A<CR>|
        |O|ko|

---

+ 以退为进
+ 执行，重复，回退
  + | 操作|重复|回退|
    |---|---|---|
    |edit|.|u|
    |f/t{char}|;|,|
    |F/T{char}|;|,|
    |/pattern<CR>|n|N|
    |?pattern<CR>|n|N|
    | : s |&|u|
    |qx{changes}q|@x|u|
+ 查找并手动替换
  + \* 会查找当前光标下的单词


## 普通模式

+ 把撤销单元切成块
  + 根据思考的提顿来切分
  + up down left right会在insert模式下额外切分
+ 构造可重复的修改
  + 使 . 发挥出最大的威力 
+ 用次数做简单的算数运算
  + 注意数字的格式
+ 能够重复(.)就别用次数
  + 使.和u命令都有更细的粒度
  + **`执行，重复，回退`**

## 插入模式

+ 在插入模式中及时修正错误
  + <C - h> 回退
  + <C - w> 删除前一个单词
  + <C - u> 删除至行首
+ 返回普通模式
  + <C - [> 
  + <C - o> 插入-普通模式
    + 可以执行一次普通模式的指令
+ 不离开插入模式，粘贴寄存器中的文本
  + <C - r>{register} 
+ 16 随时随地做运算

---

+ 用字符编码插入非常用字符
  + <C - v>{123}
  + <C - v>u{1234}
  + <C - v>{nondigit}
  + <C - k>{char1}{char2}
    + 插入二合字母表示的字符
+ 用替换模式替换已有文本
  + R
  + r -- 单个字符

## 可视模式

注意可以使用如r等命令对行，块进行操作，会作用在每一个字符上

+ 选择高亮区域
  + |命令|用途|
    |---|---|
    |v|字符|
    |V|行|
    |\<C-v> | 块|
    |gv|重选|
    |o|切换高亮选区的活动端|
  + 这些指令可以用于在不同模式下切换

---

+ 重复执行面向行的可视命令
  + . 选择的文本数量和上次相同
+ 只要可能，最好使用操作符命令，而不是可视命令
  + 可是命令的.可能会产生异常行为
  + vit，viw
  + 可视模式下，U -> gU
+ 用面向列块的可视模式编辑表格数据
  + 以列为单位工作
+ 修改列文本
  + 用列块可视模式可以同时往若干行中插入文本
+ 在长短不一的高亮块后添加文本
  + 使用$
  + 注意，i，a不能使用，要用I，A代替
  + 按下\<ESC>后会同步更改

## 命令行模式

+ 结识命令行模式
  + ：，/,\<C-r>=
  + \<C-r>{register}插入寄存器内容
  + 操作缓冲区文本的Ex命令 -- 可以无需移动光标进行修改

---

|命令|用途|
|---|---|
|[range]delete [x]|删除行到寄存器x|
|[range]yank [x]|复制|
|[line]put [x]|指定行后粘贴寄存器x的内容|
|[range]copy {address}|将指定范围内的行拷贝到{address}所指定的行之下|
|[range]move {address}|移动|
|[range]join|连接指定范围内的行|
|[range]normal {commands}|对指定范围的每一行执行普通模式命令|
|[range]substitute/{pattern}/[string]/[flags] ||
|[range]global/{pattern}/[cmd] | 对指定范围内匹配的行执行cmd|

---

+ 在一行或多个连续行上执行命令
  + |符号|地址|
    |---|---|
    |1|第一行|
    |$|最后一行|
    |0|虚拟行，位于1上方|
    |.|光标所在行|
    |'m|包含位置标记m的行|
    |'<|高亮选区的起始行|
    |'>|结束行|
    |%|所有行|
  + 可以使用高亮区域表示范围，使用模式指定范围，以及用偏移对地址进行修正

---

+ 使用':t'和':m'命令复制和移动行
  + |命令|用途|
    |---|---|
    |:6t.| line6 -> curline|
    |:t6|curline->below line6|
    |:t.|yyp|
    |:t$||
+ **在指定范围上执行普通模式命令**
  + [range]normal [cmd]
    + 如对多行执行相同的操作，如添加注释等
+ 重复上次的Ex命令
  + @:
  + bn,bp

---

+ 自动补全Ex命令
  + <C-d>显示可用的补全列表
  + <Tab> <S-Tab> 
+ 把当前单词插入到命令行
  + <C-r><C-w>:插入单词
  + <C-r><C-a>:插入字串
+ 回溯历史命令
  + set history=N
+ 结识命令行窗口
  + q:
  + |命令|动作|
    |---|---|
    |q/|查找历史命令窗口|
    |q:|打开Ex命令窗口|
    |\<C-f>|命令行模式到命令行窗口|

---

+ 运行Shell命令
  + !cmd
  + % 当前文件名称
  + :te:交互式shell会话 -- exit退出
  + :read !{cmd}把命令的标准输出重定向到缓冲区
  + write !{cmd} 把缓冲区内容传给外部的sh命令作为标准输入
  + write! {cmd} 覆盖写入一个文件
  + **使用外部命令过滤缓冲区内容**
    + [range]!{cmd}
      + [range]write !{cmd}
    + Vim对grep以及make有包装命令

---

## 文件

### 管理多个文件

+ 用缓冲区列表管理打开的文件
  + 缓冲区：文件在内存中的映像
  + :ls
    + :bprev,:bnext,bfirst,blast
    + :buffer N,:buffer {bufname}
    + :bdelete
+ 用参数列表将缓冲区分组
  + :args
    + :args {arglist:通配符，文件名，shell命令结果}
      + 填充列表参数
      + 可以使用Glob模式指定文件
        + **不可递归，*可递归
      + 使用反引号指定文件:shell命令的输出作为args的参数
  + :argdo:执行命令
  + :next,:prev

---

+ 管理隐藏缓冲区
  + Vim对修改过的缓冲区会给予特殊对待
  + 标记 h : 隐藏缓冲区
  + qa[ll]! wa[ll]!
+ 将工作区切分成窗口
  + \<C-w>s 水平切分,\<C-w>v 垂直切分
    + 编辑长文件时好用
  + sp[lit] {file} 水平打开新文件
  + vsp[lit] {file} 垂直打开新文件
  + 在窗口间切换
    + |命令|用途|
      |\<C-w>w|循环|
      |\<C-w>h|左边|
      |\<C-w>j|下边|
      |\<C-w>k|上边|
      |\<C-w>l|右边|
  + 关闭窗口
    + :clo ： 关闭所有
    + :on[ly] ： 只保留活动窗口
  + 改变窗口大小及重新排列窗口

---

+ 用标签页将窗口分组
  + lcd {path} : 设置当前窗口的本地工作目录
  + 打开及关闭标签页
    + :tabe[dit] {filename}
    + :tabc[lose]
    + :tabo[nly]
    + \<C-w>T 当前窗口移动到一个新标签页
  + 标签页直接切换
  + tabmove [N] 重排标签页

---

### 打开及保存文件

+ 用:edit命令打开文件
  + 相对于活动文件目录打开一个文件
    + :edit %:h\<Tab>{other file namee}\<Tab>
      + :h会去掉文件名只保留路径
      + Vimcast
+ 用find打开文件
  + :find
  + 可以使用set path添加寻找的路径
+ 用netrw管理文件系统
  + vim. 或 :edit .
  + 或:E[xplore]
  + 创建文件，重命名文件 -- 详细功能见Vimcast

---

+ 把文件保存到不存在的目录
  + \<C-g> 显示文件状态
  + 可以将临时创建的缓冲区保存到一个不存在的目录路径
    + 使用mkdir -p
+ 以超级用户权限保存文件
  + w !sudo tee % > /dev/null
    + 无需退出后重写

---

### 更快地移动及跳转

+ ==操作符待决模式==
+ :h motion.txt

---

+ 区分屏幕行与实际行
  + g{hjkl0^$}
+ 基于单词移动
  + w,b,e,ge,W,B,E,gE
+ 对字符进行查找
  + f,F
  + t,T{char}:字母之前
+ 通过查找进行移动
+ 用精确的文本对象选择选区
  + a/i{t[ag]}
+ 删除周边，修改内部
  + a/i{w,W,s,p}

---

+ 设置位置标记，以便快速跳回
  + m{a-zA-Z}
  + `{mark}
  + Vim自动标记的位置
    + |位置标记|跳转到|
      |---|---|
      |``||
      |`.|上次修改的地方|
      |`^|上次插入的地方|
      |`[|修改或复制的起始位置|
      |`]|结束位置|
      |`<|高亮起始位置|
      |`>|结束位置|

---

+ 在匹配括号间跳转
  + %
  + surround.vim

---

### 在文件间跳转

+ :jumps命令
  + <C-i>,<C-o>命令进行前进或者后退,非动作命令
  + [count]G命令直接跳转到指定行号
+ 遍历改变列表
  + g; 反向遍历列表
  + g, 正向遍历列表
  + Vim自动创建标记
    + `. 上次修改的位置
    + `^ 上次退出插入模式的光标位置
    + gi 命令：回到退出插入模式的地方进行编辑

---

+ 跳转到光标下的文件
  + gf
    + 可以为之制定扩展名和搜索目录
+ 用全局位置标记在文件间快速跳转
  + m{letter}
    + 小写字母：缓冲区标记
    + 大写字母：全局标记
      + 当需要浏览一些文件然后跳回原处
  + `{letter}
  + vimgrep命令
    + quickfix

---

## 寄存器

### 复制

+ 用无名寄存器实现删除、复制与粘贴操作

---

+ 深入理解Vim寄存器
  + 引用寄存器
    + "{register}
    + 黑洞寄存器
      + _
      + 不会覆盖无名寄存器的内容
    + x,s,d,c,y都可以用"{register}或者""来指定寄存器
    + 复制专用寄存器
      + "0
      + y命令
    + "a-"z
      + 覆盖
    + "A-"Z
      + 追加
    + 系统剪切板"+
    + 表达式寄存器"=
    + 其它寄存器
      + |寄存器|内容|
        |---|---|
        |"%|文件名|
        |".|上次插入的文本|
        |":|上次执行的Ex命令|
        |"/|上次查找的模式|

---

+ 用寄存器的内容替换高亮选区的文本
+ 把寄存器的内容粘贴出来
  + 插入模式中，使用<C-r>{register}来在光标前插入文本
  + gp,gP
+ 与系统粘贴板进行交互

---

### 宏

+ 宏的读取与执行
  + q{register}指定一个保存宏的寄存器
  + q停止录制
  + @{register}回放宏
  + @@回放同样的宏
  + 串行，并行的方式执行宏
+ 规范光标位置,直达目标以及终止宏
  + 黄金法则：在录制一个宏时，要确保每条命令都可以被重复执行
  + 要精确定位位置
  + 宏执行失败会自动终止
  + N@{register}
+ 加次数回放宏
  + 串行
    + N@{register}
  + 并行
    + :[range] normal @a

---

+ 给宏追加命令
  + gA
+ 在一组文件中执行宏
  + :args {file}
    + :args 查看参数列表
  + :first
    + 使光标位于第一个文件
  + 录制宏
  + :argdo normal @{register}
+ 用迭代求职的方式给列表编号
+ 编辑宏的内容

---

## 模式

### 按模式匹配及按原义匹配

+ 调整查找模式的大小写敏感性
  + 全局设置
    + ignorecase
  + 每次查找设置
    + \c 忽略大小写
    + \C 区分大小写
  + 智能推测
+ 按正则表达式才查找时，使用\v模式开关
  + Vim POSIX   Perl
  + \v 开启very magic模式，除了_,字母，数字之外都具有特殊含义
+ 按原义查找文本时，使用\V原义开关
+ 使用圆括号捕获子匹配
+ 界定单词的界限
  + <>符号表示单词定界符
  + *：正向查找光标下单词
  + #：反向

---

+ 界定匹配的边界
  + \zs 匹配开始
  + \ze 匹配结束
  + 不在\zs \ze中的也是模式的一部分
+ 转义字符问题
  + \V 原义开关
  + 首次出现的/（正向），？（反向）解释为==查找域结束符==
  + 每次都要转义\

---

### 查找

+ 结识查找命令
  + /
  + ? 反向查找
  + /\<CR> 相同模式的下一次查找
  + ?\<CR> 相同模式的上一次查找
  + 回溯之前的查找 \<Up>
+ 高亮查找匹配
  + set (no)hlsearch
+ 在执行查找前预览第一处匹配
  + set incsearch
  + \<C-r>\<C-w> 根据当前预览的匹配结果对查找域进行自动补全

---

+ 统计当前模式的匹配个数
  + :%s///gn
+ 将光标偏移到查找匹配的结尾
  + 模式后加/e
+ 84 对完整的查找模式进行操作
+ 85 利用查找历史，迭代完成复杂的模式
+ 查找当前高亮选区中的文本
  + 在vimrc中进行键映射

---

### 替换

+ 结识substitute命令
  + :[range]s/{pattern}/{string}/[flags]
  + &,\0 : 插入匹配模式所有内容
  + ~：使用上一次调用:s时的{string}
  + \={Vim script} : 将Vim script结果替换string
+ 在文件范围内查找并替换每一处匹配
+ 重复使用上次的查找模式
  + 将substitute的查找域留空
  + 为了不影响命令历史，可以使用\<C-r>/补充
+ 用寄存器的内容进行替换
  + \<C-r>{register}
  + 替换域中出现\=表示一段脚本,@{register}引用寄存器

---

+ 重复执行上一次substitute命令
  + g& = :%s//~/&
  + :&&
+ 使用子匹配重排CSV文件中的字段
  + \{1-9}
  + Vim脚本中使用submatch()函数来捕获匹配内容
  + Abolish.vim
+ 在多个文件中执行替换与查找
  + :args {file} 加入参数
  + :set hidden 在不保存文件修改的前提下，跳转至其它文件
  + 加入标志位e屏蔽报错信息
  + :vimgrep
  + :copen 打开quickfix窗口
  + vim-qargs :Qargs
  + :update 在文件发生改动时，执行保存
  + | 仅仅作为命令分隔


---

### global 命令

+ 结识global命令
  + [range] glboal[!] /{pattern}/ [cmd]
  + {pattern} 留空，使用当前查找模式
  + [cmd] 除了global命令之外的Ex命令，缺省为:print
    + [cmd]可以单独指定范围
+ 删除所有包含模式的文本行
+ 将CSS文件中的所有规则的属性按照字母排序
  + 以:g/{pattern}为参考点，动态地设定范围
  + global 广义形式
    + :g/{start}/ .,{finish} [cmd]
      + 可以套用相对地址

---

## 工具

### 通过ctags建立索引，并用其浏览源代码

+ 结识ctags
    + 建立索引tags
+ 配置Vim使用ctags
    + :set tags? 查询tags文件路径
    + :!ctags -R
+ 使用Vim的标签跳转命令，浏览关键字的定义
    + 跳转到关键字定义处
        + \<C-]>
        + \<C-t> 后退
        + g<C-]> 列出选择项
        + :tselect 调出标签匹配列表,:tnext,:tprev,:tfirst,:tlast
        + Ex命令:tags {keyword}（<C-]>） 和 :tjump {keyword}(g<C-]>)
            + 可以使用正则表达式

---

### 编译代码，并通过Quickfix列表浏览错误信息

+ 不用离开Vim也能编译代码
+ 浏览Quickfix列表
    + |命令|用途|
        |---|---|
        |:cnext||
        |:cprev||
        |:cfirst||
        |:clast||
        |:cnfile||
        |:cpfile||
        |:cc N||
        |:copen||
        |:cclose||
+ 回顾之前的Quickfix列表
    + :colder
    + :cnewer

---

+ 定制外部编译器
    + Vim的make 命令不仅限于调用外部的make程序
    + 可以通过:makeprg 制定程序
        + :setlocal makeprg=
    + 可以设置一些错误设置的选项
    + :compiler 命令会激活一个编译器插件

---

### 通过grep，vimgrep以及其他工具对整个工程进行查找

+ 不必离开Vim也能调用grep
+ 定制grep程序
    + 可以使用ack作为替代
+ 使用Vim内部的Grep
    + :vim[grep][!] / {pattern}/[g][j] {file}
    + 必须添file参数，和:args参数的用法一致
    + {pattern}留空并不会采用当前匹配模式

---

### 自动补全

+ 结识Vim的关键字自动补全
+ 与自动补全的弹出式菜单进行交互
+ 掌握关键字的来龙去脉
+ 使用字典中的单词进行自动补全
+ 自动补全整行文本
+ 自动补全文件名
+ 根据上下文自动补全
  + :h compl-omni-filetypes

---

### 利用Vim的拼写检查器，查找并更正拼写错误

+ 对你的工作进行拼写检查
    + 操作Vim拼写检查器
+ 使用其他拼写字典
+ 将单词添加到拼写文件中
+ 在插入模式下更正拼写错误
